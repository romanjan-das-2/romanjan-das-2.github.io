<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Application for Issuing of ID Cards</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f1f1f1;
        }

        .container {
            max-width: 800px;
            margin: 50px auto;
            margin-bottom: 10px;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 5px;
            background-color: #fff;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        }

        .appl_head {
            text-align: center;
            margin-bottom: 40px;
        }

        label {
            font-weight: bold;
        }

        select {
            padding: 8px;
            margin-bottom: 20px;
            width: 100%;
            border: 1px solid #ccc;
            border-radius: 4px;
            box-sizing: border-box;
        }

        ul {
            padding: 0;
            margin-top: 20px;
        }

        li {
            margin-bottom: 15px;
        }

        strong {
            font-weight: bold;
        }

        a {
            color: #007bff;
            text-decoration: none;
        }

        a:hover {
            text-decoration: underline;
        }
        
        .button_container{
            width: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        #print_button{
            background-color: #007bff;
            border-color: #007bff;
            color: white;
            font-weight: bold;
            height: 2rem;
        }
    </style>
</head>

<body>
    <div class="appl_head">
        <h2>Application for Issuing of ID Card</h2>
    </div>
    <div class="container">
        <label id="timestamp-select-label" for="timestamp-select">Select Application Date and Time:</label>
        <select id="timestamp-select"></select>
        <div id="data-container"></div>
    </div>
    <div class="button_container">
        <button id="print_button" type="button" onclick="printFunction();">Print Application</button>
    </div>
<script>
    document.addEventListener("DOMContentLoaded", function () {
        const select = document.getElementById("timestamp-select");
        const dataContainer = document.getElementById("data-container");
        let allData = null;

        // Fetch data only once when the page is loaded
        fetchAndProcessData();

        // Function to fetch data and populate dropdown
        function fetchAndProcessData() {
            fetch("https://docs.google.com/spreadsheets/d/e/2PACX-1vTP7uy73S54N6qh6vgMIVTOSRNDquVA_YgCwHHfJkcX8H4lQi1nQ4Rtl_CLsVXHYA24QzSSmzUps4KO/pub?gid=90653978&single=true&output=tsv")
                .then(response => response.text())
                .then(data => {
                    const lines = data.split("\n");
                    lines.shift(); // Remove header row
                    allData = lines.map(line => line.split("\t"));
                    populateDropdown(allData);
                })
                .catch(error => console.error("Error fetching data:", error));
        }

        // Function to populate dropdown with timestamps and names
        function populateDropdown(data) {
            // Reverse the order of the data array
            data.reverse();
            data.forEach((line, index) => {
                const timestamp = line[0];
                const name = line[1]; // Assuming name is the second element in each line
                const option = document.createElement("option");
                option.textContent = `${name} - ${timestamp}`;
                option.value = index; // Store index for easy retrieval of corresponding line
                select.appendChild(option);
            });
            // Display data for the first timestamp by default
            populateData(data[0]);
        }

        // Populate data based on selected timestamp
        select.addEventListener("change", function () {
            const selectedIndex = select.value;
            populateData(allData[selectedIndex]);
        });

        // Function to populate data container with given data
        function populateData(data) {
            dataContainer.innerHTML = ""; // Clear existing data
            const ul = document.createElement("ul");
            data.forEach((item, index) => {
                const li = document.createElement("li");
                if (index === 3) {
                    item = `<a href="${item}" target="_blank">View Photo</a>`;
                }
                if (index === 12){
                    item = `<a href="${item}" target="_blank">View Signature</a>`;
                }
                li.innerHTML = `<strong>${getHeader(index)}:</strong> ${item}`;
                ul.appendChild(li);
            });
            var slno=document.createElement("li");
            slno.innerHTML="<strong>Sl No:</strong>";
            var ivpr=document.createElement("li");
            ivpr.innerHTML="<strong>IVPR number:</strong>";
            ul.appendChild(slno); ul.appendChild(ivpr);
            dataContainer.appendChild(ul);
        }

        // Function to get header based on index
        function getHeader(index) {
            const headers = [
                "Application Date & Time",
                "Name",
                "Father's or Husband's Name",
                "Passport Size Photo",
                "Date of Birth (mm/dd/yyyy)",
                "Registration Number",
                "Blood Group",
                "Office Address",
                "Residential Address",
                "Phone Number",
                "Remarks (if any)",
                "Declaration",
                "Photo of Signature"
            ];
            return headers[index];
        }
    });

    function printFunction(){
        // Get all the <li> elements
        var listItems = document.getElementsByTagName("li");
        // Loop through each <li> element and set the bottom margin
        for (var i = 0; i < listItems.length; i++) {
            listItems[i].style.marginBottom = "30px"; // Change the bottom margin to 30px
        }
        document.body.style.backgroundColor="white";
        document.getElementById("timestamp-select-label").style.display="none";
        document.getElementById("timestamp-select").style.display="none";
        document.getElementById("print_button").style.display="none";
        document.getElementsByClassName("container")[0].style.boxShadow="0px 0px 0px #ffffff";
        document.getElementsByClassName("container")[0].style.border="1px solid #ffffff";
        window.print();
        // Loop through each <li> element and set the bottom margin
        for (var i = 0; i < listItems.length; i++) {
            listItems[i].style.marginBottom = "15px"; // Change the bottom margin to 30px
        }
        document.body.style.backgroundColor="#f1f1f1";
        document.getElementById("timestamp-select-label").style.display="block";
        document.getElementById("timestamp-select").style.display="block";
        document.getElementById("print_button").style.display="block";
        document.getElementsByClassName("container")[0].style.boxShadow="0 0 10px rgba(0, 0, 0, 0.1)";
        document.getElementsByClassName("container")[0].style.border="1px solid #ddd";
    }
</script>

</body>

</html>
